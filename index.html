<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PBQ Runner — Lesson 8 (Scenario + Tasks)</title>
  <style>
    :root {
      --bg: #f4f6fa;
      --card: #ffffff;
      --ink: #1b1f2f;
      --ink-dim: #5c6373;
      --accent: #2463eb;
      --ok: #2ba84a;
      --warn: #e0a106;
      --err: #e63946;
      --line: #dfe3eb;
      --muted-bg: #fafbff;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      background: var(--bg);
      color: var(--ink);
      font: 16px/1.5 "Segoe UI", Roboto, system-ui, sans-serif;
    }

    header {
      padding: 20px 16px;
      border-bottom: 1px solid #d7dce6;
      background: #ffffff;
      position: sticky;
      top: 0;
      z-index: 10;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    }

    h1 {
      margin: 0.2rem 0;
      font-size: 1.25rem;
      font-weight: 600;
    }

    main {
      max-width: 900px;
      margin: 32px auto;
      padding: 0 16px;
    }

    .toolbar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-wrap: wrap;
      gap: 12px;
      margin: 0.75rem 0;
    }

    .toolbar-left,
    .toolbar-right {
      display: flex;
      align-items: center;
      gap: 10px;
      flex-wrap: wrap;
    }

    .btn {
      appearance: none;
      border: 1px solid #c2c8d6;
      background: #f8f9fb;
      color: var(--ink);
      padding: 0.55rem 0.9rem;
      height: 40px;
      min-width: 130px;
      border-radius: 10px;
      cursor: pointer;
      font-weight: 500;
      line-height: 1.2;
      text-align: center;
      transition: all 0.15s ease-in-out;
      text-decoration: none;
    }
    .btn:hover { background: #eaf0ff; border-color: var(--accent); }
    .btn.primary { background: var(--accent); color: #fff; border-color: var(--accent); }
    .btn.primary:hover { background: #1f56c4; }

    .pill {
      display: inline-block;
      padding: 0.5rem 1rem;
      border-radius: 10px;
      background: #f0f4ff;
      border: 1px solid #c8d4fa;
      color: var(--accent);
      font-size: 1.1rem;
      font-weight: 600;
      letter-spacing: 0.2px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.05);
    }

    .card {
      background: var(--card);
      border: 1px solid var(--line);
      border-radius: 16px;
      padding: 18px;
      margin: 20px 0;
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.05);
    }

    .title { font-weight: 700; }
    .muted { color: var(--ink-dim); }

    .scenario-wrap {
      display: grid;
      gap: 8px;
    }
    .scenario-label {
      display: inline-block;
      padding: 0.35rem 0.75rem;
      border-radius: 999px;
      background: #e9f9ef;
      border: 1px solid #c6ebd3;
      color: #116a3d;
      font-size: 0.85rem;
      font-weight: 800;
      letter-spacing: 0.4px;
      text-transform: uppercase;
      width: max-content;
    }
    .scenario {
      white-space: pre-wrap;
      color: #2b2f3c;
    }

    .result { margin-top: 10px; font-weight: 600; }
    .correct { color: var(--ok); }
    .incorrect { color: var(--err); }

    .feedback {
      margin-top: 6px;
      padding: 0.55rem 0.7rem;
      border: 1px solid #f1c9cf;
      background: #fff5f6;
      color: #7a1e27;
      border-radius: 8px;
      font-size: 0.95rem;
    }

    footer {
      max-width: 900px;
      margin: 40px auto 80px;
      padding: 0 16px;
      color: #707789;
      font-size: 0.9rem;
      text-align: center;
    }

    select {
      background: #ffffff;
      color: var(--ink);
      border: 1px solid #cbd2e0;
      padding: 0.35rem 0.5rem;
      border-radius: 8px;
      margin: 0 0.35rem;
    }
    select:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 2px rgba(36, 99, 235, 0.2);
    }

    /* ====== PBQ 1 (Kanban) ====== */
    .lanes { display:grid; grid-template-columns: repeat(3, 1fr); gap:10px; }
    .lane {
      min-height: 160px; padding: 10px; border:1px dashed #c9d1e3; border-radius: 12px; background: var(--muted-bg); position:relative;
    }
    .lane h4 { margin:.2rem 0 .5rem; color:#2b4aa6; }
    .ghost { position:relative; padding:.3rem .5rem; font-style:italic; color:#5c6373 }
    .finding {
      background:#fff; border:1px solid var(--line); border-radius: 12px; padding:.55rem .65rem; margin:.45rem 0;
      cursor:grab; box-shadow: 0 4px 10px rgba(0,0,0,.04);
    }
    .finding.dragging { opacity:.85; border-style: solid; }
    .chips { display:flex; gap:6px; flex-wrap:wrap; margin:.15rem 0 .25rem }
    .chip { background:#eef2ff; border:1px solid #cdd7ff; color:#1f44b4; padding:.1rem .45rem; border-radius:999px; font-size:.75rem }
    .meta { color: var(--ink-dim); font-size:.9rem }

    /* ====== PBQ 4 (Matrix) ====== */
    table { width:100%; border-collapse:separate; border-spacing:0 }
    th, td { padding:10px; border-bottom:1px solid var(--line); text-align:left }
    th { background:#f6f8ff; }

    @media (max-width: 640px) {
      .toolbar { flex-direction: column; align-items: stretch; }
      .toolbar-left, .toolbar-right { justify-content: center; }
      .btn { flex: 1 1 auto; min-width: unset; }
      .lanes { grid-template-columns: 1fr; }
    }
    /* ==== Compact Header Overrides (add at end of <style>) ==== */
header{
  padding: 10px 12px;                 /* was 20px 16px */
  box-shadow: 0 1px 4px rgba(0,0,0,.05);
}

.pill{
  padding: 0.35rem 0.7rem;            /* tighter chip */
  font-size: 0.95rem;                  /* was 1.1rem */
  border-radius: 8px;
  box-shadow: none;
}

.toolbar{
  gap: 8px;
  margin: 0.4rem 0;                   /* was 0.75rem */
}

.toolbar-left, .toolbar-right{
  gap: 8px;
}

.btn{
  height: 32px;                        /* was 40px */
  min-width: 104px;                    /* was 130px */
  padding: 0.4rem 0.7rem;              /* was 0.55rem 0.9rem */
  font-size: 0.9rem;                   /* slightly smaller text */
  border-radius: 8px;                  /* less rounded */
}

.btn.primary{
  /* keep colors, just align height/rounding */
}

@media (max-width: 640px){
  /* make the compact look hold on mobile too */
  .btn{ min-width: unset; width: auto; }
  .pill{ font-size: 0.9rem; }
}
  </style>
</head>
<body>
  <header>
    <div class="pill">Lesson 8 • Vulnerability Management</div>

    <div class="toolbar">
      <div class="toolbar-left">
        <a class="btn" href="lesson8_practice_questions.html" target="_blank">Practice Questions</a>
        <a class="btn" href="audio_review.html" target="_blank">Audio Review</a>
      </div>

      <div class="toolbar-right">
        <button class="btn" id="btnReset">Reset</button>
        <button class="btn primary" id="btnCheck">Check Answers</button>
      </div>
    </div>
  </header>
  <main>
    <section class="card">
      <div class="title" id="pbq_title">KonaTech — Weekly Risk Review</div>
      <div class="muted" id="lesson">Lesson 8 – Explain Vulnerability Management</div>
      <div class="scenario-wrap">
        <div class="scenario-label">Scenario</div>
        <p class="scenario" id="scenario">
KonaTech runs continuous vulnerability scanning and imports vendor SBOMs. This week’s rollup includes exploitable CVEs,
a public cloud storage misconfiguration, legacy/EOL infrastructure, and internet-exposed assets.

Priorities from leadership:
• Minimize data exposure risk, especially from public cloud storage. 
• Keep customer-facing services available (tight maintenance windows).
• Use compensating controls when patching is not immediately feasible.
• Close out items only after verification via re-scan.

Your tasks:
1) Triage findings by urgency using exploit maturity, exposure, and business impact.
2) Choose an appropriate scan type (credentialed vs. non-credentialed) and cadence per asset, balancing depth and practicality.
        </p>
      </div>
      <!-- removed "Intermediate" / time pill per request -->
    </section>

    <!-- =================== PBQ 1: Vulnerability Triage (Kanban) =================== -->
    <section class="card" id="pbq1">
      <div class="scenario-label" style="background:#e9f3ff;border-color:#cfe0ff;color:#1b4cb8">PBQ 1</div>
      <h2 style="margin:8px 0 2px">Drag each finding into the correct lane</h2>
      <p class="muted" style="margin:0 0 8px">
        Lanes: <b>Fix Now</b> (same day), <b>Fix Next</b> (within sprint), <b>Schedule</b> (next standard window). Consider exploitability, exposure, business impact, and maintenance windows.
      </p>
      <div class="lanes" style="margin-top:8px">
        <div class="lane" data-lane="NOW"><h4>Fix Now</h4></div>
        <div class="lane" data-lane="NEXT"><h4>Fix Next</h4></div>
        <div class="lane" data-lane="LATER"><h4>Schedule</h4></div>
      </div>
      <div id="pool" style="margin-top:10px"></div>
      <div class="result" id="pbq1_result"></div>
      <div class="feedback" id="pbq1_fb" hidden></div>
    </section>

    <!-- =================== PBQ 4: Scan Strategy Matrix =================== -->
    <section class="card" id="pbq4">
      <div class="scenario-label" style="background:#e9f3ff;border-color:#cfe0ff;color:#1b4cb8">PBQ 2</div>
      <h2 style="margin:8px 0 2px">Design the scan strategy</h2>
      <p class="muted" style="margin:0 0 8px">
        Choose <b>scan type</b> and <b>cadence</b> per asset. Use <b>credentialed</b> scans for deeper configuration/patch validation and <b>non-credentialed</b> for the external “attacker’s-eye” view. Verification via <b>re-scan</b> is required for closure.
      </p>
      <div style="overflow-x:auto">
        <table>
          <thead>
            <tr>
              <th>Asset</th><th>Context</th><th>Scan Type</th><th>Cadence</th>
            </tr>
          </thead>
          <tbody id="scan_tbody"></tbody>
        </table>
      </div>
      <div class="result" id="pbq4_result"></div>
      <div class="feedback" id="pbq4_fb" hidden></div>
    </section>
  </main>

  <footer>
    Triage + strategy = identify → analyze → treat (patch/config/compensating controls) → verify (re-scan).
  </footer>

  <script>
/* tiny qs helpers */
const $ = (sel, el=document) => el.querySelector(sel);
const $$ = (sel, el=document) => Array.from(el.querySelectorAll(sel));

/* =================== PBQ 1: Vulnerability Triage (Kanban) =================== */
const FINDINGS = [
  { id:'F1', title:'Public cloud bucket allows listing + read of PII', tags:['Cloud','Exposure','Misconfig'], meta:'Impact: High • Exposure: Public • Exploit maturity: Live', expect:'NOW',
    why:'Public data exposure represents immediate risk; apply bucket-level public access block and least-privilege policy now, then verify via re-scan.'},
  { id:'F2', title:'DB-01 — Critical RCE (CVSS 9.8) with weaponized exploit', tags:['Server','Critical','RCE'], meta:'Impact: High • Exploit: Known in wild', expect:'NOW',
    why:'High-value system + weaponized exploit → emergency change: patch ASAP or apply compensating controls (WAF/IPS isolation) until patched.'},
  { id:'F3', title:'HR-LAP12 — High-sev CVE (8.1), PoC only, standard user', tags:['Endpoint','PoC'], meta:'Impact: Low • Exploit: Proof-of-Concept', expect:'NEXT',
    why:'Lower business impact and only PoC → remediate within sprint; confirm via credentialed endpoint scan.'},
  { id:'F4', title:'WEB-02 — Deprecated 3DES enabled on TLS', tags:['Crypto','Config'], meta:'Impact: Medium • Weak cipher', expect:'NEXT',
    why:'Cryptographic hardening needed; schedule cipher suite update in sprint, maintain availability, then re-scan to verify deprecation.'},
  { id:'F5', title:'Legacy backup host on EOL OS (segmented zone)', tags:['EOL','Legacy','Segmented'], meta:'Impact: Medium • Exposure: Internal-only', expect:'LATER',
    why:'If properly segmented, plan OS upgrade/migration in the next standard window; add network ACLs as compensating control until replaced.'}
];

let KANBAN_STATE = { NOW:[], NEXT:[], LATER:[], POOL:[] };

function makeFindingCard(f){
  const el = document.createElement('div');
  el.className='finding'; el.draggable=true; el.dataset.id=f.id;
  el.innerHTML = `
    <div class="chips">${f.tags.map(t=>`<span class="chip">${t}</span>`).join(' ')}</div>
    <div style="font-weight:700">${f.title}</div>
    <div class="meta">${f.meta}</div>`;
  el.addEventListener('dragstart', e=>{ el.classList.add('dragging'); e.dataTransfer.setData('text/plain', f.id); });
  el.addEventListener('dragend', ()=> el.classList.remove('dragging'));
  return el;
}

function renderKanban(){
  const lanes = { NOW:$('[data-lane="NOW"]'), NEXT:$('[data-lane="NEXT"]'), LATER:$('[data-lane="LATER"]') };

  // Clear all existing finding cards and old ghost hints
  Object.values(lanes).forEach(l=>{
    l.querySelectorAll('.finding, .ghost').forEach(el=>el.remove());
  });

  // Render findings into lanes
  for(const lane of ['NOW','NEXT','LATER']){
    KANBAN_STATE[lane].forEach(f => lanes[lane].appendChild(makeFindingCard(f)));
    // Add hint only if empty AFTER rendering
    if(!KANBAN_STATE[lane].length){
      const ghost = document.createElement('div');
      ghost.className='ghost';
      ghost.textContent='Drag here';
      lanes[lane].appendChild(ghost);
    }
  }

  // Render pool
  const pool = $('#pool');
  pool.innerHTML = '';
  KANBAN_STATE.POOL.forEach(f => pool.appendChild(makeFindingCard(f)));
}

function setupDnd(){
  const zones = [ $('[data-lane="NOW"]'), $('[data-lane="NEXT"]'), $('[data-lane="LATER"]'), $('#pool') ];
  zones.forEach(zone=>{
    zone.addEventListener('dragover', e=>{ e.preventDefault(); zone.style.outline='1px dashed #7aa0ff'; });
    zone.addEventListener('dragleave', ()=> zone.style.outline='none');
    zone.addEventListener('drop', e=>{
      e.preventDefault(); zone.style.outline='none';
      const id = e.dataTransfer.getData('text/plain');
      moveTo(zone.id ? 'POOL' : zone.dataset.lane, id);
      renderKanban();
    });
  });
}
function moveTo(target, id){
  for(const lane of ['NOW','NEXT','LATER','POOL']){
    const i = KANBAN_STATE[lane].findIndex(x=>x.id===id);
    if(i>=0){ KANBAN_STATE[lane].splice(i,1); break; }
  }
  KANBAN_STATE[target].push(FINDINGS.find(x=>x.id===id));
}

function initKanban(){
  KANBAN_STATE = { NOW:[], NEXT:[], LATER:[], POOL: [...FINDINGS].sort(()=>Math.random()-0.5) };
  renderKanban(); setupDnd();
}
function gradeKanban(){
  let correct=0, total=FINDINGS.length; const fb=[];
  for(const lane of ['NOW','NEXT','LATER']){
    for(const f of KANBAN_STATE[lane]){
      if(lane===f.expect) correct++; else fb.push(`• ${f.title}: should be in ${f.expect}. ${f.why}`);
    }
  }
  $('#pbq1_result').textContent = `${correct}/${total} placed correctly`;
  $('#pbq1_result').className = 'result ' + (correct===total ? 'correct' : 'incorrect');
  const el = $('#pbq1_fb'); if(fb.length){ el.hidden=false; el.innerHTML=fb.join('<br>'); } else { el.hidden=true; el.textContent=''; }
}

/* =================== PBQ 4: Scan Strategy Matrix =================== */
const ASSETS = [
  { name:'DMZ Web Server', ctx:'Internet-facing; frequent releases; SLA-sensitive', expectType:'Credentialed', expectCadence:'Weekly',
    why:'Credentialed scans validate patch levels and hardening; public exposure merits frequent cycles (weekly) with verification via re-scan.'},
  { name:'Finance DB', ctx:'High confidentiality/integrity; narrow maintenance windows', expectType:'Credentialed', expectCadence:'Weekly',
    why:'Deeper checks catch missing patches/config drift; schedule within approved windows; verify via re-scan before closure.'},
  { name:'Partner API Gateway', ctx:'Perimeter control; rate-limited; third-party clients', expectType:'Non-credentialed', expectCadence:'Daily',
    why:'External, attacker’s-eye coverage catches exposed vulns quickly with light impact; pair with periodic credentialed scans off-hours.'},
  { name:'EOL Backup Host (segmented)', ctx:'Legacy OS; isolated network segment; migration planned', expectType:'Credentialed', expectCadence:'Bi-weekly',
    why:'Credentialed depth supports compensating controls and migration planning; lower cadence acceptable due to segmentation.'}
];
const TYPES = ['Credentialed','Non-credentialed'];
const CAD   = ['Daily','Weekly','Bi-weekly','Monthly'];

function renderScanMatrix(){
  const tb = $('#scan_tbody'); tb.innerHTML='';
  ASSETS.forEach((a,i)=>{
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td><b>${a.name}</b></td>
      <td class="muted">${a.ctx}</td>
      <td>
        <select data-i="${i}" data-k="t">
          <option value="" selected disabled>— select —</option>
          ${TYPES.map(v=>`<option value="${v}">${v}</option>`).join('')}
        </select>
      </td>
      <td>
        <select data-i="${i}" data-k="c">
          <option value="" selected disabled>— select —</option>
          ${CAD.map(v=>`<option value="${v}">${v}</option>`).join('')}
        </select>
      </td>`;
    tb.appendChild(tr);
  });
}
function gradeScanMatrix(){
  let correct=0, total=ASSETS.length*2; const fb=[];
  $$('#scan_tbody select').forEach(sel=>{
    const i = Number(sel.dataset.i), k = sel.dataset.k, row = ASSETS[i], v = sel.value;
    if(!v) return;
    if(k==='t'){ if(v===row.expectType) correct++; else fb.push(`• ${row.name}: use ${row.expectType}. ${row.why}`); }
    else { if(v===row.expectCadence) correct++; else fb.push(`• ${row.name}: cadence ${row.expectCadence}. ${row.why}`); }
  });
  $('#pbq4_result').textContent = `${correct}/${total} selections correct`;
  $('#pbq4_result').className = 'result ' + (correct===total ? 'correct' : 'incorrect');
  const el = $('#pbq4_fb'); if(fb.length){ el.hidden=false; el.innerHTML=fb.join('<br>'); } else { el.hidden=true; el.textContent=''; }
}

/* =================== Global Check/Reset =================== */
function checkAll(){
  gradeKanban();
  gradeScanMatrix();
}
function resetAll(){
  initKanban();
  renderScanMatrix();
  // clear results
  ['pbq1_result','pbq4_result'].forEach(id=>{ const n = document.getElementById(id); if(n) n.textContent=''; });
  ['pbq1_fb','pbq4_fb'].forEach(id=>{ const n = document.getElementById(id); if(n){ n.hidden=true; n.textContent=''; } });
}

window.addEventListener('DOMContentLoaded', ()=>{
  initKanban();
  renderScanMatrix();
  document.getElementById('btnCheck')?.addEventListener('click', checkAll);
  document.getElementById('btnReset')?.addEventListener('click', resetAll);
});
  </script>
</body>
</html>
